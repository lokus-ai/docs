---
title: Plugin API Reference
description: Complete reference for the Lokus Plugin API - commands, editor, UI, filesystem, network, and storage APIs.
keywords: [lokus, plugin api, api reference, commands api, editor api, ui api, filesystem api]
---

# API Reference

Complete reference for the Lokus Plugin API. Plugins receive a `PluginContext` during construction and an activation context during `activate()`.

## Plugin Structure

```typescript
import { PluginContext } from 'lokus-plugin-sdk';

export default class MyPlugin {
  private context: PluginContext;

  constructor(context: PluginContext) {
    this.context = context;
  }

  async activate(activationContext: any): Promise<void> {
    // Register commands via activationContext
    activationContext.commands.registerCommand('myPlugin.cmd', {
      callback: () => {}
    });

    // Access other APIs via this.context
    this.context.ui.showInformationMessage('Plugin activated!');
  }

  async deactivate(): Promise<void> {
    // Cleanup
  }
}
```

## API Overview

| API | Access | Purpose |
|-----|--------|---------|
| [Logger](#logger-api) | `context.logger` | Logging and debugging |
| [UI](#ui-api) | `context.ui` | Notifications and dialogs |
| [Editor](#editor-api) | `context.editor` | Editor operations |
| [Commands](#commands-api) | `activationContext.commands` | Command registration |
| [Filesystem](#filesystem-api) | `context.fs` | File operations |
| [Network](#network-api) | `context.network` | HTTP requests |
| [Storage](#storage-api) | `context.storage` | Plugin data storage |
| [Clipboard](#clipboard-api) | `context.clipboard` | Clipboard access |

---

## Logger API

Access: `context.logger`

Log messages for debugging. Logs appear in Lokus Developer Tools console.

### Methods

```typescript
// Information message
context.logger.info(message: string, ...args: any[]): void

// Warning message
context.logger.warn(message: string, ...args: any[]): void

// Error message
context.logger.error(message: string, ...args: any[]): void

// Debug message (only shown in dev mode)
context.logger.debug(message: string, ...args: any[]): void
```

### Example

```typescript
constructor(context: PluginContext) {
  this.context = context;
  this.context.logger.info('Plugin initialized');
}

async activate() {
  try {
    // ... setup
    this.context.logger.info('Plugin activated successfully');
  } catch (error) {
    this.context.logger.error('Activation failed:', error);
  }
}
```

---

## UI API

Access: `context.ui`

Display notifications and dialogs to the user.

### showInformationMessage()

Show an info notification.

```typescript
context.ui.showInformationMessage(message: string): void
```

### showWarningMessage()

Show a warning notification.

```typescript
context.ui.showWarningMessage(message: string): void
```

### showErrorMessage()

Show an error notification.

```typescript
context.ui.showErrorMessage(message: string): void
```

### showInputBox()

Show an input dialog and get user input.

```typescript
context.ui.showInputBox(options?: InputBoxOptions): Promise<string | null>

interface InputBoxOptions {
  title?: string;
  prompt?: string;
  placeholder?: string;
  value?: string;  // Default value
  validateInput?: (value: string) => string | null;  // Return error message or null
}
```

### showConfirm()

Show a confirmation dialog.

```typescript
context.ui.showConfirm(options: ConfirmOptions): Promise<boolean>

interface ConfirmOptions {
  title: string;
  message: string;
  confirmText?: string;  // Default: "OK"
  cancelText?: string;   // Default: "Cancel"
}
```

### registerPanel()

Register a custom UI panel.

```typescript
context.ui.registerPanel(panel: PanelDefinition): Disposable

interface PanelDefinition {
  id: string;
  title: string;
  location: 'sidebar' | 'bottom';
  icon?: string;
  component?: React.ComponentType;
  initialState?: Record<string, any>;
}
```

### addPanel()

Add a panel to the UI.

```typescript
context.ui.addPanel(panel: AddPanelOptions): Panel

interface AddPanelOptions {
  id: string;
  title: string;
  position: 'sidebar-left' | 'sidebar-right' | 'bottom' | 'modal';
  icon?: string;
  component?: React.ComponentType;
  props?: Record<string, any>;
}
```

### createOutputChannel()

Create an output channel for logging.

```typescript
context.ui.createOutputChannel(name: string): OutputChannel

interface OutputChannel {
  name: string;
  append(value: string): void;
  appendLine(value: string): void;
  clear(): void;
  show(preserveFocus?: boolean): void;
  hide(): void;
  dispose(): void;
}
```

### Example

```typescript
async activate() {
  // Show notification
  this.context.ui.showInformationMessage('Plugin loaded!');

  // Get user input
  const name = await this.context.ui.showInputBox({
    title: 'Enter Name',
    prompt: 'What is your name?',
    placeholder: 'John Doe'
  });

  if (name) {
    this.context.ui.showInformationMessage(`Hello, ${name}!`);
  }

  // Confirm action
  const confirmed = await this.context.ui.showConfirm({
    title: 'Confirm',
    message: 'Are you sure you want to continue?'
  });

  if (confirmed) {
    // proceed...
  }
}
```

---

## Editor API

Access: `context.editor`

Interact with the TipTap-based editor.

### addSlashCommand()

Add a slash command to the editor.

```typescript
context.editor.addSlashCommand(command: SlashCommand): Promise<string>

interface SlashCommand {
  name: string;
  description: string;
  icon?: string;
  aliases?: string[];
  execute: () => void | Promise<void>;
}
```

### addToolbarItem()

Add a button to the editor toolbar.

```typescript
context.editor.addToolbarItem(item: ToolbarItem): string

interface ToolbarItem {
  id: string;
  title: string;
  icon: string;
  group?: string;  // Default: 'plugin'
  handler: () => void;
  isActive?: () => boolean;
  isDisabled?: () => boolean;
}
```

### addContextMenuItem()

Add an item to the right-click context menu.

```typescript
context.editor.addContextMenuItem(item: ContextMenuItem): string

interface ContextMenuItem {
  id: string;
  name: string;
  icon?: string;
  condition?: () => boolean;
  execute: () => void;
}
```

### addKeyboardShortcut()

Register a keyboard shortcut.

```typescript
context.editor.addKeyboardShortcut(shortcut: KeyboardShortcut): string

interface KeyboardShortcut {
  key: string;  // e.g., 'Mod-Shift-K' (Mod = Cmd on Mac, Ctrl elsewhere)
  handler: () => boolean;  // Return true to prevent default
  description?: string;
}
```

### addDropHandler()

Handle drag & drop events.

```typescript
context.editor.addDropHandler(handler: DropHandler): string

interface DropHandler {
  accept: string | string[];  // MIME types, e.g., 'image/*'
  handler: (files: File[]) => void | Promise<void>;
}
```

### addExtension()

Add a TipTap extension to the editor.

```typescript
context.editor.addExtension(extension: ExtensionConfig): Promise<string>

interface ExtensionConfig {
  name: string;
  type?: 'extension' | 'node' | 'mark';
  schema?: object;
  view?: object;
  commands?: object;
  inputRules?: any[];
  keyboardShortcuts?: object;
}
```

### getSelection()

Get the current text selection.

```typescript
context.editor.getSelection(): Promise<Selection | null>

interface Selection {
  from: number;
  to: number;
  text: string;
  empty: boolean;
}
```

### replaceSelection()

Replace the current selection with new content.

```typescript
context.editor.replaceSelection(content: string): Promise<void>
```

### getText()

Get the editor content as plain text.

```typescript
context.editor.getText(): Promise<string>
```

### insertNode()

Insert a node at the current cursor position.

```typescript
context.editor.insertNode(
  type: string,
  attrs?: Record<string, any>,
  content?: string
): Promise<void>
```

### onUpdate()

Subscribe to editor content changes.

```typescript
context.editor.onUpdate(callback: (content: string) => void): Disposable
```

### Example

```typescript
async activate() {
  const editor = this.context.editor;

  // Add slash command
  await editor.addSlashCommand({
    name: 'greeting',
    description: 'Insert a greeting',
    icon: 'ðŸ‘‹',
    execute: async () => {
      await editor.insertNode('paragraph', {}, 'Hello, World!');
    }
  });

  // Add toolbar button
  editor.addToolbarItem({
    id: 'my-button',
    title: 'Insert Date',
    icon: 'calendar',
    handler: async () => {
      const date = new Date().toLocaleDateString();
      await editor.replaceSelection(date);
    }
  });

  // Add keyboard shortcut
  editor.addKeyboardShortcut({
    key: 'Mod-Shift-D',
    description: 'Insert current date',
    handler: async () => {
      const date = new Date().toLocaleDateString();
      await editor.replaceSelection(date);
      return true;
    }
  });
}
```

---

## Commands API

Access: `activationContext.commands` (in activate method)

Register commands that appear in the command palette.

### registerCommand()

Register a command.

```typescript
activationContext.commands.registerCommand(
  id: string,
  options: CommandOptions
): Disposable

interface CommandOptions {
  name?: string;
  description?: string;
  shortcut?: string;
  callback: (...args: any[]) => void | Promise<void>;
  // Alternative property name (both work)
  execute?: (...args: any[]) => void | Promise<void>;
}
```

### Example

```typescript
async activate(activationContext: any) {
  // Register a simple command
  activationContext.commands.registerCommand('myPlugin.hello', {
    name: 'Say Hello',
    description: 'Shows a greeting',
    callback: () => {
      this.context.ui.showInformationMessage('Hello!');
    }
  });

  // Register command with arguments
  activationContext.commands.registerCommand('myPlugin.greet', {
    name: 'Greet User',
    callback: (name: string) => {
      this.context.ui.showInformationMessage(`Hello, ${name}!`);
    }
  });

  // Register with shortcut
  activationContext.commands.registerCommand('myPlugin.quickAction', {
    name: 'Quick Action',
    shortcut: 'Ctrl+Shift+Q',
    callback: () => {
      // Action...
    }
  });
}
```

---

## Filesystem API

Access: `context.fs`

File operations scoped to the plugin's directory for security.

### readFile()

Read a file from the plugin directory.

```typescript
context.fs.readFile(relativePath: string): Promise<Uint8Array>
```

### writeFile()

Write content to a file in the plugin directory.

```typescript
context.fs.writeFile(relativePath: string, content: string | Uint8Array): Promise<void>
```

### exists()

Check if a file exists.

```typescript
context.fs.exists(relativePath: string): Promise<boolean>
```

### readdir()

List files in a directory.

```typescript
context.fs.readdir(relativePath: string): Promise<string[]>
```

### mkdir()

Create a directory.

```typescript
context.fs.mkdir(relativePath: string): Promise<void>
```

### delete()

Delete a file or directory.

```typescript
context.fs.delete(relativePath: string): Promise<void>
```

### rename()

Rename a file or directory.

```typescript
context.fs.rename(oldPath: string, newPath: string): Promise<void>
```

### copy()

Copy a file.

```typescript
context.fs.copy(source: string, destination: string): Promise<void>
```

### stat()

Get file information.

```typescript
context.fs.stat(path: string): Promise<FileStat>

interface FileStat {
  isFile: boolean;
  isDirectory: boolean;
  size: number;
  mtime: Date;
}
```

### openFileDialog()

Open a file picker dialog.

```typescript
context.fs.openFileDialog(options: FileDialogOptions): Promise<string[]>

interface FileDialogOptions {
  accept?: string[];  // File extensions, e.g., ['.txt', '.md']
  multiple?: boolean;
  title?: string;
}
```

### Example

```typescript
async saveData() {
  const data = JSON.stringify({ count: 42 });
  await this.context.fs.writeFile('data.json', data);
}

async loadData() {
  if (await this.context.fs.exists('data.json')) {
    const content = await this.context.fs.readFile('data.json');
    const text = new TextDecoder().decode(content);
    return JSON.parse(text);
  }
  return null;
}
```

---

## Network API

Access: `context.network`

Make HTTP requests. Requires `network` permission.

### fetch()

Make an HTTP request.

```typescript
context.network.fetch(url: string, options?: RequestInit): Promise<Response>
```

### Example

```typescript
async fetchData() {
  try {
    const response = await this.context.network.fetch('https://api.example.com/data');
    const data = await response.json();
    return data;
  } catch (error) {
    this.context.logger.error('Network request failed:', error);
    throw error;
  }
}
```

**Note:** Network access requires the `network` permission in your manifest:

```json
{
  "permissions": ["network:fetch"]
}
```

---

## Storage API

Access: `context.storage`

Persistent key-value storage for plugin data.

### getDatabase()

Get a database instance for storing data.

```typescript
context.storage.getDatabase(name: string): Promise<Database>

interface Database {
  get(key: string): Promise<any>;
  set(key: string, value: any): Promise<void>;
  delete(key: string): Promise<void>;
  keys(): Promise<string[]>;
  clear(): Promise<void>;
}
```

### Example

```typescript
async saveSettings(settings: Record<string, any>) {
  const db = await this.context.storage.getDatabase('settings');
  for (const [key, value] of Object.entries(settings)) {
    await db.set(key, value);
  }
}

async loadSettings() {
  const db = await this.context.storage.getDatabase('settings');
  const keys = await db.keys();
  const settings: Record<string, any> = {};
  for (const key of keys) {
    settings[key] = await db.get(key);
  }
  return settings;
}
```

---

## Clipboard API

Access: `context.clipboard`

Read and write to the system clipboard.

### writeText()

Write text to the clipboard.

```typescript
context.clipboard.writeText(text: string): Promise<void>
```

### read()

Read from the clipboard.

```typescript
context.clipboard.read(): Promise<ClipboardItems>
```

### Example

```typescript
async copyToClipboard() {
  const selection = await this.context.editor.getSelection();
  if (selection && selection.text) {
    await this.context.clipboard.writeText(selection.text);
    this.context.ui.showInformationMessage('Copied to clipboard!');
  }
}
```

---

## Disposable Pattern

Many API methods return a `Disposable` object. Call `dispose()` to clean up resources.

```typescript
interface Disposable {
  dispose(): void;
}
```

### Example

```typescript
class MyPlugin {
  private disposables: Disposable[] = [];

  async activate(activationContext: any) {
    // Store disposables for cleanup
    this.disposables.push(
      activationContext.commands.registerCommand('myPlugin.cmd', {
        callback: () => {}
      })
    );

    this.disposables.push(
      this.context.editor.onUpdate((content) => {
        console.log('Content changed');
      })
    );
  }

  async deactivate() {
    // Dispose all resources
    for (const disposable of this.disposables) {
      disposable.dispose();
    }
    this.disposables = [];
  }
}
```

---

## Permissions

Declare required permissions in your `plugin.json`:

```json
{
  "permissions": [
    "editor:read",
    "editor:write",
    "commands:register",
    "ui:notifications",
    "filesystem:read",
    "filesystem:write",
    "network:fetch",
    "storage:read",
    "storage:write",
    "clipboard:read",
    "clipboard:write"
  ]
}
```

### Permission Categories

| Category | Permissions |
|----------|-------------|
| Editor | `editor:read`, `editor:write` |
| Commands | `commands:register`, `commands:execute` |
| UI | `ui:notifications`, `ui:create` |
| Filesystem | `filesystem:read`, `filesystem:write`, `filesystem:delete` |
| Network | `network:fetch`, `network:websocket` |
| Storage | `storage:read`, `storage:write` |
| Clipboard | `clipboard:read`, `clipboard:write` |

---

## Error Handling

Always wrap API calls in try-catch blocks:

```typescript
async doSomething() {
  try {
    const content = await this.context.editor.getText();
    // process content...
  } catch (error) {
    this.context.logger.error('Operation failed:', error);
    this.context.ui.showErrorMessage('Operation failed. Please try again.');
  }
}
```

---

## Next Steps

- [Getting Started](/developers/plugins/getting-started) - Create your first plugin
- [Plugin Manifest](/developers/plugins/manifest) - Manifest reference
- [Editor Plugins](/developers/plugins/editor-plugins) - Advanced editor integrations
- [Publishing](/developers/plugins/publishing) - Publish to the marketplace
